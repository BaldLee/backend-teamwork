webpackJsonp([1],{CTVt:function(e,t){},FHaZ:function(e,t){},Mq4q:function(e,t){},NHnr:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("7+uW"),a={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var s=r("VU/8")({name:"App"},a,!1,function(e){r("cp38")},null,null).exports,n=r("mtWM"),i=r.n(n),l=r("zL8q"),u=r.n(l),c=(r("tvR6"),r("/ocq")),m={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-container",{staticClass:"container"},[r("el-header",{staticClass:"header"},[r("img",{attrs:{src:"http://localhost:8080/image-service/books/"+e.book.id,alt:e.book.id}})]),e._v(" "),r("el-main",[r("h4",[e._v(e._s(this.book.title)+"("+e._s(this.book.author)+")")]),e._v(" "),r("el-rate",{attrs:{colors:e.colors,disabled:e.disabled},on:{change:e.rateBook},model:{value:e.rate,callback:function(t){e.rate=t},expression:"rate"}})],1)],1)},staticRenderFns:[]};var d={name:"Home",data:function(){return{books:"",currentPage:1,allPage:1}},components:{Book:r("VU/8")({name:"Book",props:["book"],data:function(){return{image:"",rate:1,colors:["#99A9BF","#F7BA2A","#FF9900"],disabled:!1}},methods:{rateBook:function(){this.disabled=!0,this.axios({url:"/rating-book-service/insertRate",method:"get",params:{userId:this.$store.getters.getId,bookId:this.book.id,point:this.rate}})},init:function(){var e=this;this.rate=1,this.disabled=!1,this.$store.getters.getLogin&&this.axios({url:"/rating-book-service/getRate/",method:"get",params:{userId:this.$store.getters.getId,bookId:this.book.id},headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(function(t){t.data.point>0&&(e.rate=t.data.point,e.disabled=!0)})}},created:function(){this.init()},watch:{book:function(e,t){this.init()}},deactivated:function(){this.$destroy()}},m,!1,function(e){r("CTVt")},"data-v-53f3add2",null).exports},created:function(){var e=this;this.axios({url:"/book-service/books",method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(function(t){console.log(t.data),e.books=t.data,e.allPage=Math.ceil(t.data.length/3),console.log(e.allPage)})},methods:{logout:function(){alert("注销成功！"),this.$store.dispatch("login",!1)},goto:function(e){this.$router.push(e)},last:function(){this.currentPage--},next:function(){this.currentPage++}},deactivated:function(){this.$destroyed()}},p={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-container",{staticClass:"container"},[r("el-header",{staticClass:"header"},[!0===e.$store.getters.getLogin?r("h4",[e._v("您已登录 用户名:"+e._s(e.$store.getters.getName)+" 用户id:"+e._s(e.$store.getters.getId))]):r("h4",[e._v("请登录")]),e._v(" "),r("h1",[e._v("书评网")])]),e._v(" "),r("el-container",[r("el-aside",{staticClass:"aside"},[r("el-menu",[r("el-menu-item-group",{staticClass:"items"},[!1===e.$store.getters.getLogin?r("el-menu-item",{attrs:{index:"1"},on:{click:function(t){return e.goto("/login")}}},[e._v("登录")]):r("el-menu-item",{attrs:{index:"4"},on:{click:e.logout}},[e._v("注销")]),e._v(" "),r("el-menu-item",{attrs:{index:"2"},on:{click:function(t){return e.goto("/register")}}},[e._v("注册")]),e._v(" "),r("el-menu-item",{attrs:{index:"3"},on:{click:function(t){return e.goto("/upload")}}},[e._v("上传")])],1)],1)],1),e._v(" "),r("el-main",{staticClass:"main"},[e._l(e.books.slice(3*e.currentPage-3,3*e.currentPage),function(t){return e.$store.getters.getLogin?r("ul",{staticClass:"book"},[r("li",[r("Book",{attrs:{book:t}})],1)]):e._e()}),e._v(" "),r("div",{staticClass:"button"},[r("el-button",{staticClass:"last",attrs:{disabled:1===e.currentPage},on:{click:e.last}},[e._v("上一页")]),e._v(" "),r("el-button",{staticClass:"next",attrs:{disabled:e.currentPage===e.allPage},on:{click:e.next}},[e._v("下一页")])],1)],2)],1)],1)},staticRenderFns:[]};var f=r("VU/8")(d,p,!1,function(e){r("FHaZ")},"data-v-620df676",null).exports,h=r("Xxa5"),v=r.n(h),g=r("exGp"),F=r.n(g),b={name:"login",data:function(){return{b:"",ruleForm:{pass:"",userName:""},rules:{pass:[{validator:function(e,t,r){""===t?r(new Error("请输入密码")):r()},trigger:"blur"}],userName:[{validator:function(e,t,r){""===t?r(new Error("请输入用户名")):r()},trigger:"blur"}]}}},methods:{validateName:function(e,t){},submitForm:function(e){var t=this;return F()(v.a.mark(function r(){return v.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:t.b="fail",t.axios({url:"/user-service/login/check",method:"get",params:{usn:t.ruleForm.userName,psw:t.ruleForm.pass},headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){t.b=e.data,console.log(e.data.token),"S"===t.b[0]&&t.$store.commit("set_token",e.data.token)}).then(function(r){t.$refs[e].validate(function(e){if(!e||"S"!==t.b[0])return alert("登录失败！"),!1;alert("登录成功！"),t.$store.dispatch("login",!0),t.$store.dispatch("name",t.ruleForm.userName),t.$store.dispatch("id",t.b.substr(1)),t.$router.push("/")})});case 2:case"end":return r.stop()}},r,t)}))()},resetForm:function(e){this.$refs[e].resetFields()}}},k={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,"status-icon":"",rules:e.rules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"用户名",prop:"userName"}},[r("el-input",{model:{value:e.ruleForm.userName,callback:function(t){e.$set(e.ruleForm,"userName",t)},expression:"ruleForm.userName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"密码",prop:"pass"}},[r("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.ruleForm.pass,callback:function(t){e.$set(e.ruleForm,"pass",t)},expression:"ruleForm.pass"}})],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("登录")]),e._v(" "),r("el-button",{on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("重置")])],1)],1)},staticRenderFns:[]};var _=r("VU/8")(b,k,!1,function(e){r("Mq4q")},"data-v-5daf0ba4",null).exports,x={name:"register",data:function(){var e=this;return{ruleForm:{pass:"",checkPass:"",phone:"",email:"",name:"",userName:""},rules:{pass:[{validator:function(t,r,o){""===r?o(new Error("请输入密码")):(""!==e.ruleForm.checkPass&&e.$refs.ruleForm.validateField("checkPass"),o())},trigger:"blur"}],checkPass:[{validator:function(t,r,o){""===r?o(new Error("请再次输入密码")):r!==e.ruleForm.pass?o(new Error("两次输入密码不一致!")):o()},trigger:"blur"}],userName:[{validator:function(e,t,r){""===t?r(new Error("用户名不能为空")):r()},trigger:"blur"}]}}},methods:{submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;alert("注册成功！"),t.axios({url:"/user-service/signup",method:"post",data:{username:t.ruleForm.userName,password:t.ruleForm.pass},headers:{"Content-Type":"application/json;charset=UTF-8"}}),t.$router.push("/login")})},resetForm:function(e){this.$refs[e].resetFields()}},deactivated:function(){this.$destroy()}},$={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,"status-icon":"",rules:e.rules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"用户名",prop:"userName"}},[r("el-input",{attrs:{type:"text","auto-complete":"off"},model:{value:e.ruleForm.userName,callback:function(t){e.$set(e.ruleForm,"userName",t)},expression:"ruleForm.userName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"密码",prop:"pass"}},[r("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.ruleForm.pass,callback:function(t){e.$set(e.ruleForm,"pass",t)},expression:"ruleForm.pass"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"确认密码",prop:"checkPass"}},[r("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.ruleForm.checkPass,callback:function(t){e.$set(e.ruleForm,"checkPass",t)},expression:"ruleForm.checkPass"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"手机",prop:"phone"}},[r("el-input",{attrs:{type:"tel","auto-complete":"off"},model:{value:e.ruleForm.phone,callback:function(t){e.$set(e.ruleForm,"phone",t)},expression:"ruleForm.phone"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[r("el-input",{attrs:{type:"email","auto-complete":"off"},model:{value:e.ruleForm.email,callback:function(t){e.$set(e.ruleForm,"email",t)},expression:"ruleForm.email"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"名字",prop:"name"}},[r("el-input",{attrs:{type:"text","auto-complete":"off"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("注册")]),e._v(" "),r("el-button",{on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("重置")])],1)],1)},staticRenderFns:[]};var w=r("VU/8")(x,$,!1,function(e){r("Po1c")},null,null).exports,y={name:"upload",data:function(){return{ruleForm:{title:"",author:""},rules:{title:[{validator:function(e,t,r){""===t?r(new Error("请输入书名")):r()},trigger:"blur"}]},fileList:[]}},methods:{submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e||""===t.fileList||null===t.fileList)return console.log("error submit!!"),!1;var r=new FormData;r.append("book",t.fileList[0]),t.axios({url:"/book-service/insert",method:"post",auth:{username:"123",password:"123"},data:{author:t.ruleForm.author,title:t.ruleForm.title},headers:{"Content-Type":"application/json;charset=UTF-8",Authorization:t.$store.state.token}}).then(function(e){t.axios({url:"/image-service/books/"+e.data,method:"post",data:r,headers:{"Content-Type":"multipart/form-data;charset=UTF-8"}})}).then(function(e){alert("上传成功！"),t.$router.push("/")})})},resetForm:function(e){this.$refs[e].resetFields()}}},N={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,"status-icon":"",rules:e.rules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"书名",prop:"title"}},[r("el-input",{attrs:{type:"text"},model:{value:e.ruleForm.title,callback:function(t){e.$set(e.ruleForm,"title",t)},expression:"ruleForm.title"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"作者",prop:"author"}},[r("el-input",{attrs:{type:"text","auto-complete":"off"},model:{value:e.ruleForm.author,callback:function(t){e.$set(e.ruleForm,"author",t)},expression:"ruleForm.author"}})],1),e._v(" "),r("el-form-item",[r("el-upload",{staticClass:"upload-demo",attrs:{action:"https://jsonplaceholder.typicode.com/posts/",multiple:"",limit:1,"file-list":e.fileList}},[r("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")]),e._v(" "),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpg/png文件，且不超过500kb")])],1),e._v(" "),r("form",{attrs:{action:"/book-service/insert"}})],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("上传")]),e._v(" "),r("el-button",{on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("重置")])],1)],1)},staticRenderFns:[]};var C=r("VU/8")(y,N,!1,function(e){r("qFgd")},null,null).exports;o.default.use(c.a);var P=new c.a({mode:"history",routes:[{path:"/",name:"home",component:f},{path:"/login",name:"login",components:{default:_}},{path:"/register",name:"register",components:{default:w}},{path:"/upload",name:"upload",components:{default:C}}]}),L=r("NYxO");o.default.use(L.a);var T={isLogin:!1,userName:"",userId:"",token:""},I={getLogin:function(e){return e.isLogin},getName:function(){return T.userName},getId:function(){return T.userId}},E={setLogin:function(e,t){e.isLogin=t},setName:function(e,t){e.userName=t},setId:function(e,t){e.userId=t},set_token:function(e,t){e.token=t,sessionStorage.token=t},del_token:function(e){e.token="",sessionStorage.removeItem("token")}},U=new L.a.Store({state:T,getters:I,mutations:E,actions:{login:function(e,t){e.commit("setLogin",t)},name:function(e,t){e.commit("setName",t)},id:function(e,t){e.commit("setId",t)}}});o.default.config.productionTip=!1,i.a.defaults.withCredentials=!0,i.a.defaults.baseURL="http://localhost:8080",o.default.prototype.axios=i.a,o.default.use(u.a),new o.default({el:"#app",router:P,store:U,components:{App:s},template:"<App/>"})},Po1c:function(e,t){},cp38:function(e,t){},qFgd:function(e,t){},tvR6:function(e,t){}},["NHnr"]);